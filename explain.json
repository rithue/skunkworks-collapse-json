{
  "serverInfo": {
    "host": "atlas-g9vyn2-shard-00-01.fsqn9.mongodb.net",
    "port": 27016,
    "version": "7.0.8",
    "gitVersion": "c5d33e55ba38d98e2f48765ec4e55338d67a4a64"
  },
  "serverParameters": {
    "internalQueryFacetBufferSizeBytes": 104857600,
    "internalQueryFacetMaxOutputDocSizeBytes": 104857600,
    "internalLookupStageIntermediateDocumentMaxSizeBytes": 104857600,
    "internalDocumentSourceGroupMaxMemoryBytes": 104857600,
    "internalQueryMaxBlockingSortMemoryUsageBytes": 104857600,
    "internalQueryProhibitBlockingMergeOnMongoS": 0,
    "internalQueryMaxAddToSetBytes": 104857600,
    "internalDocumentSourceSetWindowFieldsMaxMemoryBytes": 104857600,
    "internalQueryFrameworkControl": "trySbeRestricted"
  },
  "explainVersion": "2",
  "queryPlanner": {
    "namespace": "mcoopon.sessions",
    "indexFilterSet": false,
    "parsedQuery": {
      "$and": [
        {
          "phoneNumber": { "$eq": "601141218355" }
        },
        {
          "updatedAt": {
            "$eq": "2023-12-21T06:39:06.062Z"
          }
        }
      ]
    },
    "queryHash": "006A5DDA",
    "planCacheKey": "C75B58FB",
    "optimizedPipeline": true,
    "maxIndexedOrSolutionsReached": false,
    "maxIndexedAndSolutionsReached": false,
    "maxScansToExplodeReached": false,
    "winningPlan": {
      "queryPlan": {
        "stage": "EQ_LOOKUP",
        "planNodeId": 3,
        "foreignCollection": "mcoopon.profiles",
        "localField": "phoneNumber",
        "foreignField": "phone",
        "asField": "profile_data",
        "strategy": "HashJoin",
        "inputStage": {
          "stage": "FETCH",
          "planNodeId": 2,
          "filter": {
            "updatedAt": {
              "$eq": "2023-12-21T06:39:06.062Z"
            }
          },
          "inputStage": {
            "stage": "IXSCAN",
            "planNodeId": 1,
            "keyPattern": { "phoneNumber": 1 },
            "indexName": "phoneNumber_1",
            "isMultiKey": false,
            "multiKeyPaths": {
              "phoneNumber": []
            },
            "isUnique": false,
            "isSparse": false,
            "isPartial": false,
            "indexVersion": 2,
            "direction": "forward",
            "indexBounds": {
              "phoneNumber": [
                "[\"601141218355\", \"601141218355\"]"
              ]
            }
          }
        }
      },
      "slotBasedPlan": {
        "slots": "$$RESULT=s33 env: { s7 = KS(3C36303131343132313833353500FE04), s15 = 1703140746062, s3 = Timestamp(1715326528, 1) (CLUSTER_TIME), s1 = TimeZoneDatabase(Pacific/Fiji...Asia/Famagusta) (timeZoneDB), s2 = Nothing (SEARCH_META), s11 = {\"phoneNumber\" : 1}, s4 = 1715326528959 (NOW), s6 = KS(3C363031313431323138333535000104) }",
        "stages": "[3] mkbson s33 s12 [] drop [profile_data = s32] true false \n[3] project [s32 = (s31 ?: [])] \n[3] hash_lookup [s31 = addToArray(s16)] \n    outer s23 \n        [3] nlj inner [s12] [s12] \n            left \n                [2] filter {traverseF(s14, lambda(l1.0) { ((l1.0 == s15) ?: false) }, false)} \n                [2] nlj inner [] [s5, s8, s9, s10, s11] \n                    left \n                        [1] cfilter {(exists(s6) && exists(s7))} \n                        [1] ixseek s6 s7 s10 s5 s8 s9 [] @\"5c4ecf91-39c8-4a59-960d-f63e35a4f062\" @\"phoneNumber_1\" true \n                    right \n                        [2] limit 1ll \n                        [2] seek s5 s12 s13 s8 s9 s10 s11 [s14 = updatedAt] @\"5c4ecf91-39c8-4a59-960d-f63e35a4f062\" true false \n            right \n                [3] project [s23 = \n                    if isArrayEmpty(s21) \n                    then [null] \n                    else s21 \n               ] \n                [3] group [] [s21 = addToSet(s19)] spillSlots[s22] mergingExprs[aggSetUnion(s22)] \n                [3] unwind s19 s20 s18 true \n                [3] project [s18 = getField(s12, \"phoneNumber\")] \n                [3] limit 1ll \n                [3] coscan \n    inner s29 [s16] \n        [3] nlj inner [s16] [s16] \n            left \n                [3] scan s16 s17 none none none none [] @\"b03486b6-5f34-48ce-953c-e28da47852c2\" true false \n            right \n                [3] group [] [s29 = addToSet(s28)] spillSlots[s30] mergingExprs[aggSetUnion(s30)] \n                [3] nlj inner [] [s24] \n                    left \n                        [3] project [s24 = (getField(s16, \"phone\") ?: null)] \n                        [3] limit 1ll \n                        [3] coscan \n                    right \n                        [3] branch {isArray(s24)} [s28] \n                        [s27] [3] union [s27] \n                            branch0 [s25] \n                                [3] unwind s25 s26 s24 true \n                                [3] limit 1ll \n                                [3] coscan \n                            branch1 [s24] \n                                [3] limit 1ll \n                                [3] coscan \n                        \n                        [s24] [3] limit 1ll \n                        [3] coscan \n"
      }
    },
    "rejectedPlans": []
  },
  "executionStats": {
    "executionSuccess": true,
    "nReturned": 1,
    "executionTimeMillis": 1,
    "totalKeysExamined": 2,
    "totalDocsExamined": 3,
    "executionStages": {
      "stage": "mkbson",
      "planNodeId": 3,
      "nReturned": 1,
      "executionTimeMillisEstimate": 0,
      "opens": 1,
      "closes": 1,
      "saveState": 0,
      "restoreState": 0,
      "isEOF": 1,
      "objSlot": 33,
      "rootSlot": 12,
      "fieldBehavior": "drop",
      "fields": [],
      "projectFields": ["profile_data"],
      "projectSlots": [32],
      "forceNewObject": true,
      "returnOldObject": false,
      "inputStage": {
        "stage": "project",
        "planNodeId": 3,
        "nReturned": 1,
        "executionTimeMillisEstimate": 0,
        "opens": 1,
        "closes": 1,
        "saveState": 0,
        "restoreState": 0,
        "isEOF": 1,
        "projections": { "32": "(s31 ?: []) " },
        "inputStage": {
          "stage": "hash_lookup",
          "planNodeId": 3,
          "nReturned": 1,
          "executionTimeMillisEstimate": 0,
          "opens": 1,
          "closes": 1,
          "saveState": 0,
          "restoreState": 0,
          "isEOF": 1,
          "totalDocsExamined": 3,
          "totalKeysExamined": 2,
          "collectionScans": 1,
          "collectionSeeks": 2,
          "indexScans": 0,
          "indexSeeks": 1,
          "indexesUsed": ["phoneNumber_1"],
          "usedDisk": false,
          "spilledRecords": 0,
          "spilledBytesApprox": 0,
          "inputStages": [
            {
              "stage": "nlj",
              "planNodeId": 3,
              "nReturned": 1,
              "executionTimeMillisEstimate": 0,
              "opens": 1,
              "closes": 1,
              "saveState": 0,
              "restoreState": 0,
              "isEOF": 1,
              "totalDocsExamined": 2,
              "totalKeysExamined": 2,
              "collectionScans": 0,
              "collectionSeeks": 2,
              "indexScans": 0,
              "indexSeeks": 1,
              "indexesUsed": ["phoneNumber_1"],
              "innerOpens": 1,
              "innerCloses": 1,
              "outerProjects": [12],
              "outerCorrelated": [12],
              "outerStage": {
                "stage": "filter",
                "planNodeId": 2,
                "nReturned": 1,
                "executionTimeMillisEstimate": 0,
                "opens": 1,
                "closes": 1,
                "saveState": 0,
                "restoreState": 0,
                "isEOF": 1,
                "numTested": 2,
                "filter": "traverseF(s14, lambda(l1.0) { ((l1.0 == s15) ?: false) }, false) ",
                "inputStage": {
                  "stage": "nlj",
                  "planNodeId": 2,
                  "nReturned": 2,
                  "executionTimeMillisEstimate": 0,
                  "opens": 1,
                  "closes": 1,
                  "saveState": 0,
                  "restoreState": 0,
                  "isEOF": 1,
                  "totalDocsExamined": 2,
                  "totalKeysExamined": 2,
                  "collectionScans": 0,
                  "collectionSeeks": 2,
                  "indexScans": 0,
                  "indexSeeks": 1,
                  "indexesUsed": [
                    "phoneNumber_1"
                  ],
                  "innerOpens": 2,
                  "innerCloses": 1,
                  "outerProjects": [],
                  "outerCorrelated": [
                    5, 8, 9, 10, 11
                  ],
                  "outerStage": {
                    "stage": "cfilter",
                    "planNodeId": 1,
                    "nReturned": 2,
                    "executionTimeMillisEstimate": 0,
                    "opens": 1,
                    "closes": 1,
                    "saveState": 0,
                    "restoreState": 0,
                    "isEOF": 1,
                    "numTested": 1,
                    "filter": "(exists(s6) && exists(s7)) ",
                    "inputStage": {
                      "stage": "ixseek",
                      "planNodeId": 1,
                      "nReturned": 2,
                      "executionTimeMillisEstimate": 0,
                      "opens": 1,
                      "closes": 1,
                      "saveState": 0,
                      "restoreState": 0,
                      "isEOF": 1,
                      "indexName": "phoneNumber_1",
                      "keysExamined": 2,
                      "seeks": 1,
                      "numReads": 3,
                      "indexKeySlot": 10,
                      "recordIdSlot": 5,
                      "snapshotIdSlot": 8,
                      "indexIdentSlot": 9,
                      "outputSlots": [],
                      "indexKeysToInclude": "00000000000000000000000000000000",
                      "seekKeyLow": "s6 ",
                      "seekKeyHigh": "s7 "
                    }
                  },
                  "innerStage": {
                    "stage": "limit",
                    "planNodeId": 2,
                    "nReturned": 2,
                    "executionTimeMillisEstimate": 0,
                    "opens": 2,
                    "closes": 1,
                    "saveState": 0,
                    "restoreState": 0,
                    "isEOF": 1,
                    "limit": 1,
                    "inputStage": {
                      "stage": "seek",
                      "planNodeId": 2,
                      "nReturned": 2,
                      "executionTimeMillisEstimate": 0,
                      "opens": 2,
                      "closes": 1,
                      "saveState": 0,
                      "restoreState": 0,
                      "isEOF": 0,
                      "numReads": 2,
                      "recordSlot": 12,
                      "recordIdSlot": 13,
                      "seekKeySlot": 5,
                      "snapshotIdSlot": 8,
                      "indexIdentSlot": 9,
                      "indexKeySlot": 10,
                      "indexKeyPatternSlot": 11,
                      "fields": ["updatedAt"],
                      "outputSlots": [14]
                    }
                  }
                }
              },
              "innerStage": {
                "stage": "project",
                "planNodeId": 3,
                "nReturned": 1,
                "executionTimeMillisEstimate": 0,
                "opens": 1,
                "closes": 1,
                "saveState": 0,
                "restoreState": 0,
                "isEOF": 1,
                "projections": {
                  "23": "\n    if isArrayEmpty(s21) \n    then [null] \n    else s21 \n"
                },
                "inputStage": {
                  "stage": "group",
                  "planNodeId": 3,
                  "nReturned": 1,
                  "executionTimeMillisEstimate": 0,
                  "opens": 1,
                  "closes": 1,
                  "saveState": 0,
                  "restoreState": 0,
                  "isEOF": 1,
                  "groupBySlots": [],
                  "expressions": {
                    "21": "addToSet(s19) ",
                    "initExprs": { "21": null }
                  },
                  "mergingExprs": {
                    "22": "aggSetUnion(s22) "
                  },
                  "usedDisk": false,
                  "spills": 0,
                  "spilledRecords": 0,
                  "spilledDataStorageSize": 0,
                  "inputStage": {
                    "stage": "unwind",
                    "planNodeId": 3,
                    "nReturned": 1,
                    "executionTimeMillisEstimate": 0,
                    "opens": 1,
                    "closes": 1,
                    "saveState": 0,
                    "restoreState": 0,
                    "isEOF": 1,
                    "inputSlot": 18,
                    "outSlot": 19,
                    "outIndexSlot": 20,
                    "preserveNullAndEmptyArrays": 1,
                    "inputStage": {
                      "stage": "project",
                      "planNodeId": 3,
                      "nReturned": 1,
                      "executionTimeMillisEstimate": 0,
                      "opens": 1,
                      "closes": 1,
                      "saveState": 0,
                      "restoreState": 0,
                      "isEOF": 1,
                      "projections": {
                        "18": "getField(s12, \"phoneNumber\") "
                      },
                      "inputStage": {
                        "stage": "limit",
                        "planNodeId": 3,
                        "nReturned": 1,
                        "executionTimeMillisEstimate": 0,
                        "opens": 1,
                        "closes": 1,
                        "saveState": 0,
                        "restoreState": 0,
                        "isEOF": 1,
                        "limit": 1,
                        "inputStage": {
                          "stage": "coscan",
                          "planNodeId": 3,
                          "nReturned": 1,
                          "executionTimeMillisEstimate": 0,
                          "opens": 1,
                          "closes": 1,
                          "saveState": 0,
                          "restoreState": 0,
                          "isEOF": 0
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "stage": "nlj",
              "planNodeId": 3,
              "nReturned": 1,
              "executionTimeMillisEstimate": 0,
              "opens": 1,
              "closes": 1,
              "saveState": 0,
              "restoreState": 0,
              "isEOF": 1,
              "totalDocsExamined": 1,
              "totalKeysExamined": 0,
              "collectionScans": 1,
              "collectionSeeks": 0,
              "indexScans": 0,
              "indexSeeks": 0,
              "indexesUsed": [],
              "innerOpens": 1,
              "innerCloses": 1,
              "outerProjects": [16],
              "outerCorrelated": [16],
              "outerStage": {
                "stage": "scan",
                "planNodeId": 3,
                "nReturned": 1,
                "executionTimeMillisEstimate": 0,
                "opens": 1,
                "closes": 1,
                "saveState": 0,
                "restoreState": 0,
                "isEOF": 1,
                "numReads": 1,
                "recordSlot": 16,
                "recordIdSlot": 17,
                "fields": [],
                "outputSlots": []
              },
              "innerStage": {
                "stage": "group",
                "planNodeId": 3,
                "nReturned": 1,
                "executionTimeMillisEstimate": 0,
                "opens": 1,
                "closes": 1,
                "saveState": 0,
                "restoreState": 0,
                "isEOF": 1,
                "groupBySlots": [],
                "expressions": {
                  "29": "addToSet(s28) ",
                  "initExprs": { "29": null }
                },
                "mergingExprs": {
                  "30": "aggSetUnion(s30) "
                },
                "usedDisk": false,
                "spills": 0,
                "spilledRecords": 0,
                "spilledDataStorageSize": 0,
                "inputStage": {
                  "stage": "nlj",
                  "planNodeId": 3,
                  "nReturned": 1,
                  "executionTimeMillisEstimate": 0,
                  "opens": 1,
                  "closes": 1,
                  "saveState": 0,
                  "restoreState": 0,
                  "isEOF": 1,
                  "totalDocsExamined": 0,
                  "totalKeysExamined": 0,
                  "collectionScans": 0,
                  "collectionSeeks": 0,
                  "indexScans": 0,
                  "indexSeeks": 0,
                  "indexesUsed": [],
                  "innerOpens": 1,
                  "innerCloses": 1,
                  "outerProjects": [],
                  "outerCorrelated": [24],
                  "outerStage": {
                    "stage": "project",
                    "planNodeId": 3,
                    "nReturned": 1,
                    "executionTimeMillisEstimate": 0,
                    "opens": 1,
                    "closes": 1,
                    "saveState": 0,
                    "restoreState": 0,
                    "isEOF": 1,
                    "projections": {
                      "24": "(getField(s16, \"phone\") ?: null) "
                    },
                    "inputStage": {
                      "stage": "limit",
                      "planNodeId": 3,
                      "nReturned": 1,
                      "executionTimeMillisEstimate": 0,
                      "opens": 1,
                      "closes": 1,
                      "saveState": 0,
                      "restoreState": 0,
                      "isEOF": 1,
                      "limit": 1,
                      "inputStage": {
                        "stage": "coscan",
                        "planNodeId": 3,
                        "nReturned": 1,
                        "executionTimeMillisEstimate": 0,
                        "opens": 1,
                        "closes": 1,
                        "saveState": 0,
                        "restoreState": 0,
                        "isEOF": 0
                      }
                    }
                  },
                  "innerStage": {
                    "stage": "branch",
                    "planNodeId": 3,
                    "nReturned": 1,
                    "executionTimeMillisEstimate": 0,
                    "opens": 1,
                    "closes": 1,
                    "saveState": 0,
                    "restoreState": 0,
                    "isEOF": 1,
                    "numTested": 1,
                    "thenBranchOpens": 0,
                    "thenBranchCloses": 0,
                    "elseBranchOpens": 1,
                    "elseBranchCloses": 1,
                    "filter": "isArray(s24) ",
                    "thenSlots": [27],
                    "elseSlots": [24],
                    "outputSlots": [28],
                    "thenStage": {
                      "stage": "union",
                      "planNodeId": 3,
                      "nReturned": 0,
                      "executionTimeMillisEstimate": 0,
                      "opens": 0,
                      "closes": 0,
                      "saveState": 0,
                      "restoreState": 0,
                      "isEOF": 0,
                      "inputSlots": [25, 24],
                      "outputSlots": [27],
                      "inputStages": [
                        {
                          "stage": "unwind",
                          "planNodeId": 3,
                          "nReturned": 0,
                          "executionTimeMillisEstimate": 0,
                          "opens": 0,
                          "closes": 0,
                          "saveState": 0,
                          "restoreState": 0,
                          "isEOF": 0,
                          "inputSlot": 24,
                          "outSlot": 25,
                          "outIndexSlot": 26,
                          "preserveNullAndEmptyArrays": 1,
                          "inputStage": {
                            "stage": "limit",
                            "planNodeId": 3,
                            "nReturned": 0,
                            "executionTimeMillisEstimate": 0,
                            "opens": 0,
                            "closes": 0,
                            "saveState": 0,
                            "restoreState": 0,
                            "isEOF": 0,
                            "inputStage": {
                              "stage": "coscan",
                              "planNodeId": 3,
                              "nReturned": 0,
                              "executionTimeMillisEstimate": 0,
                              "opens": 0,
                              "closes": 0,
                              "saveState": 0,
                              "restoreState": 0,
                              "isEOF": 0
                            }
                          }
                        },
                        {
                          "stage": "limit",
                          "planNodeId": 3,
                          "nReturned": 0,
                          "executionTimeMillisEstimate": 0,
                          "opens": 0,
                          "closes": 0,
                          "saveState": 0,
                          "restoreState": 0,
                          "isEOF": 0,
                          "inputStage": {
                            "stage": "coscan",
                            "planNodeId": 3,
                            "nReturned": 0,
                            "executionTimeMillisEstimate": 0,
                            "opens": 0,
                            "closes": 0,
                            "saveState": 0,
                            "restoreState": 0,
                            "isEOF": 0
                          }
                        }
                      ]
                    },
                    "elseStage": {
                      "stage": "limit",
                      "planNodeId": 3,
                      "nReturned": 1,
                      "executionTimeMillisEstimate": 0,
                      "opens": 1,
                      "closes": 1,
                      "saveState": 0,
                      "restoreState": 0,
                      "isEOF": 1,
                      "limit": 1,
                      "inputStage": {
                        "stage": "coscan",
                        "planNodeId": 3,
                        "nReturned": 1,
                        "executionTimeMillisEstimate": 0,
                        "opens": 1,
                        "closes": 1,
                        "saveState": 0,
                        "restoreState": 0,
                        "isEOF": 0
                      }
                    }
                  }
                }
              }
            }
          ]
        }
      }
    },
    "allPlansExecution": []
  },
  "command": {
    "aggregate": "sessions",
    "pipeline": [
      {
        "$match": {
          "phoneNumber": "601141218355",
          "updatedAt": "2023-12-21T06:39:06.062Z"
        }
      },
      {
        "$lookup": {
          "from": "profiles",
          "localField": "phoneNumber",
          "foreignField": "phone",
          "as": "profile_data"
        }
      }
    ],
    "cursor": {},
    "maxTimeMS": 60000,
    "let": {},
    "fromMongos": false,
    "$db": "mcoopon"
  },
  "ok": 1,
  "$clusterTime": {
    "clusterTime": {
      "$timestamp": "7367271339721228289"
    },
    "signature": {
      "hash": "JjQs92RiHl2zMMsmLoo2RYJhn8s=",
      "keyId": {
        "low": 22,
        "high": 1713922891,
        "unsigned": false
      }
    }
  },
  "operationTime": {
    "$timestamp": "7367271339721228289"
  }
}